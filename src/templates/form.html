<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rescue Card Generator</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link rel="icon" href="/favicon.png" type="image/png" />
    <style>
      .error-flash {
        animation: flash 0.5s ease-in-out;
      }

      @keyframes flash {
        0% {
          border-color: #f56565; /* Red border */
          box-shadow: 0 0 0 0.2rem rgba(245, 101, 101, 0.25);
        }
        100% {
          border-color: #e0e0e0; /* Default border color (adjust if needed) */
          box-shadow: none;
        }
      }

      /* Tooltip styles */
      .tooltip {
        position: relative;
        display: inline-block;
      }

      .tooltip .tooltiptext {
        visibility: hidden;
        width: 150px;
        background-color: #374151; /* Dark gray */
        color: #f3f4f6; /* Light gray */
        text-align: center;
        border-radius: 0.375rem;
        padding: 0.5rem;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        opacity: 0;
        transition: opacity 0.3s;
      }

      .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
      }

      .tooltip .tooltiptext::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: #374151 transparent transparent transparent;
      }

      /* Form styling to match card */
      .form-container {
        background-color: #f9fafb; /* Light gray background */
        border-radius: 0.5rem;
        box-shadow:
          0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        padding: 2rem;
        max-width: 600px; /* Slightly wider form */
        width: 100%;
      }

      .form-title {
        color: #dc2626; /* Red color */
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 1.5rem;
        text-align: center;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-label {
        display: block;
        color: #374151; /* Dark gray */
        font-weight: bold;
        margin-bottom: 0.5rem;
        font-size: 0.875rem;
      }

      .form-input,
      .form-select,
      .form-textarea {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #d1d5db; /* Light gray border */
        border-radius: 0.375rem;
        box-shadow: rgba(0, 0, 0, 0.05) 0px 1px 2px 0px;
        font-size: 0.875rem;
      }

      .form-input:focus,
      .form-select:focus,
      .form-textarea:focus {
        outline: none;
        border-color: #6366f1; /* Indigo focus color */
        box-shadow:
          rgba(99, 102, 241, 0.25) 0px 1px 2px 0px,
          rgba(99, 102, 241, 0.1) 0px 0px 0px 3px;
      }

      .form-error {
        color: #dc2626; /* Red error text */
        font-size: 0.75rem;
        margin-top: 0.25rem;
      }

      .submit-button {
        background-color: #dc2626; /* Red submit button */
        color: #f9fafb; /* Light gray text */
        font-weight: bold;
        padding: 0.75rem 1.5rem;
        border-radius: 0.375rem;
        border: none;
        cursor: pointer;
        width: 100%;
        transition: background-color 0.15s ease-in-out;
      }

      .submit-button:hover {
        background-color: #b91c1c; /* Darker red on hover */
      }
    </style>
  </head>

  <body class="bg-gray-100 flex justify-center items-center min-h-screen">
    <div class="form-container">
      <h1 class="form-title">Rescue Card Generator</h1>
      <form
        id="generatorForm"
        method="POST"
        action="/"
        enctype="multipart/form-data"
      >
        <div class="form-group">
          <label for="name" class="form-label tooltip">
            Name:
            <span class="tooltiptext"
              >The name that will appear on the card.</span
            >
          </label>
          <input
            type="text"
            id="name"
            name="name"
            required
            class="form-input"
            aria-describedby="name-error"
          />
          <p id="name-error" class="form-error hidden">Please enter a name.</p>
        </div>
        <div class="form-group">
          <label for="photo" class="form-label tooltip">
            Profile Photo (Max 1MB):
            <span class="tooltiptext"
              >A photo to display on the card. Maximum size is 1MB.</span
            >
          </label>
          <input
            type="file"
            id="photo"
            name="photo"
            accept="image/*"
            class="form-input"
            onchange="validateFileSize()"
          />
          <p id="fileSizeError" class="form-error hidden">
            File size exceeds 1MB.
          </p>
        </div>
        <div class="form-group">
          <label for="extraInformation" class="form-label tooltip">
            Extra Information:
            <span class="tooltiptext"
              >Any additional information (Markdown accepted).</span
            >
          </label>
          <textarea
            id="extraInformation"
            name="markdownContent"
            rows="5"
            class="form-textarea"
          ></textarea>
        </div>
        <div class="form-group">
          <label for="pin" class="form-label tooltip">
            PIN:
            <span class="tooltiptext">A 4-digit PIN for security.</span>
          </label>
          <input
            type="password"
            id="pin"
            name="pin"
            minlength="4"
            maxlength="4"
            required
            class="form-input"
            aria-describedby="pin-error"
          />
          <p id="pin-error" class="form-error hidden">
            Please enter a 4-digit PIN.
          </p>
        </div>
        <div class="form-group">
          <label for="bloodType" class="form-label tooltip">
            Blood Type:
            <span class="tooltiptext">The person's blood type.</span>
          </label>
          <select id="bloodType" name="bloodType" class="form-select">
            <option value="">Select Blood Type</option>
            <option value="O+">O+</option>
            <option value="O-">O-</option>
            <option value="A+">A+</option>
            <option value="A-">A-</option>
            <option value="B+">B+</option>
            <option value="B-">B-</option>
            <option value="AB+">AB+</option>
            <option value="AB-">AB-</option>
          </select>
        </div>
        <div class="form-group">
          <label for="allergies" class="form-label tooltip">
            Allergies:
            <span class="tooltiptext">Any known allergies.</span>
          </label>
          <input
            type="text"
            id="allergies"
            name="allergies"
            class="form-input"
          />
        </div>
        <div class="form-group">
          <label for="medications" class="form-label tooltip">
            Medications:
            <span class="tooltiptext">Current medications.</span>
          </label>
          <input
            type="text"
            id="medications"
            name="medications"
            class="form-input"
          />
        </div>
        <div class="form-group">
          <label for="medicalConditions" class="form-label tooltip">
            Medical Conditions:
            <span class="tooltiptext">Existing medical conditions.</span>
          </label>
          <input
            type="text"
            id="medicalConditions"
            name="medicalConditions"
            class="form-input"
          />
        </div>
        <div class="form-group">
          <label for="emergencyContactName" class="form-label tooltip">
            Emergency Contact Name:
            <span class="tooltiptext">Name of the emergency contact.</span>
          </label>
          <input
            type="text"
            id="emergencyContactName"
            name="emergencyContactName"
            class="form-input"
          />
        </div>
        <div class="form-group">
          <label for="emergencyContactPhone" class="form-label tooltip">
            Emergency Contact Phone:
            <span class="tooltiptext"
              >Phone number of the emergency contact.</span
            >
          </label>
          <input
            type="text"
            id="emergencyContactPhone"
            name="emergencyContactPhone"
            class="form-input"
          />
        </div>
        <div class="form-group">
          <label for="emergencyContactRelationship" class="form-label tooltip">
            Emergency Contact Relationship:
            <span class="tooltiptext"
              >Relationship to the emergency contact.</span
            >
          </label>
          <input
            type="text"
            id="emergencyContactRelationship"
            name="emergencyContactRelationship"
            class="form-input"
          />
        </div>
        <button type="submit" class="submit-button">
          Generate Rescue Card
        </button>
      </form>
    </div>

    <script>
      const MAX_FILE_SIZE_MB = 1;
      const MAX_FILE_SIZE_BYTES = MAX_FILE_SIZE_MB * 1024 * 1024;
      const fileInput = document.getElementById("photo");
      const photoLabel = document.getElementById("photoLabel");
      const fileSizeError = document.getElementById("fileSizeError");
      const form = document.getElementById("generatorForm");
      let isFileSizeErrorVisible = false; // Track if the error is currently visible

      function validateFileSize() {
        if (fileInput.files.length > 0) {
          const file = fileInput.files[0];
          if (file.size > MAX_FILE_SIZE_BYTES) {
            fileSizeError.classList.remove("hidden");
            fileInput.value = ""; // Clear the invalid file
            triggerErrorFeedback();
            isFileSizeErrorVisible = true;
          } else {
            fileSizeError.classList.add("hidden");
            fileInput.classList.remove("error-flash");
            isFileSizeErrorVisible = false;
          }
        } else {
          fileInput.classList.remove("error-flash");
          isFileSizeErrorVisible = false;
        }
      }

      function triggerErrorFeedback() {
        fileInput.classList.add("error-flash");
        setTimeout(() => {
          fileInput.classList.remove("error-flash");
        }, 500); // Remove flash after 0.5 seconds
        photoLabel.scrollIntoView({ behavior: "smooth", block: "start" }); // Scroll to the error
      }

      form.addEventListener("submit", function (event) {
        if (fileInput.files.length > 0) {
          const file = fileInput.files[0];
          if (file.size > MAX_FILE_SIZE_BYTES) {
            event.preventDefault(); // Prevent form submission
            fileSizeError.classList.remove("hidden");
            triggerErrorFeedback();
            isFileSizeErrorVisible = true;
          }
        } else if (isFileSizeErrorVisible) {
          // If there was a previous error and no file is selected, ensure error is visible and scroll
          fileSizeError.classList.remove("hidden");
          triggerErrorFeedback();
        }
      });
    </script>
  </body>
</html>
